<Title:>
  Chat ({{count(messages)}}) - {{_page.user.name}}

<Head:>
  <meta name="viewport" content="width=device-width">

<Body:>
  <div id="page">
    <view name="chat"
      collection="{{messages}}"
      users="{{users}}"
      user="{{_page.user}}"
      room="{{_page.room}}">
    </view>
  </div>
  <view name="scripts"></view>

<chat:>
  <div id="messages" as="container" on="scroll: onScroll()">
    <ul id="messages-list" as="list">
      {{each list as #message}}
        <li><view name="chat-message"></view></li>
      {{/}}
    </ul>
  </div>
  <div id="foot">
    <div class="pic {{user.picClass}}"></div>
    <div id="inputs">
      <input id="inputs-name" value="{{user.name}}">
      <form id="inputs-form" on="submit: messages.add()">
        <input id="inputs-comment" value="{{newComment}}" autofocus>
      </form>
    </div>
  </div>

<chat-message:>
  <div class="pic {{users[#message.userId].picClass}}"></div>
  <div class="message">
    <p class="time">{{displayTime(#message)}}</p>
    <p><b>{{users[#message.userId].name}}</b></p>
    <p>{{#message.comment}}</p>
  </div>

<scripts:>
  <!-- Scroll to bottom immediately on page render and on a resize. -->
  <script>
    (window.onresize = function() {
      var height = document.getElementById('messages-list').offsetHeight;
      document.getElementById('messages').scrollTop = height;
    })();
  </script>
